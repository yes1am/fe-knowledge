## 数学/等差数列


### 1. 题目

如下图:

![WechatIMG108](https://user-images.githubusercontent.com/25051945/119308213-5bbf0780-bc9f-11eb-94af-70abe0269978.jpeg)

```js
a[0] = [0,0]
a[1] = [1,0]
a[2] = [0,1]
a[3] = [0,2]
a[4] = [1,1]
a[5] = [2,0]
a[6] = [3,0]
a[7] = [2,1]
a[8] = [1,2]
a[9] = [0,3]
a[10] = [0,4]
a[11] = [1,3]
```

求 a[n] 的坐标？

### 2. 思路

首先，我们可以找出如下的规律，即每条斜线的元素数量是递增的: 1,2,3,4 ...
```js
// 第 1 条斜线
a[0] = [0,0]

// 第 2 条斜线
a[1] = [1,0]
a[2] = [0,1]

// 第 3 条斜线
a[3] = [0,2]
a[4] = [1,1]
a[5] = [2,0]

// 第 4 条斜线
a[6] = [3,0]
a[7] = [2,1]
a[8] = [1,2]
a[9] = [0,3]

// 第 5 条斜线
a[10] = [0,4]
a[11] = [1,3]
a[12] = [2,2]
a[13] = [3,1]
a[14] = [4,0]

// 第 6 条斜线
a[15] = [5,0]
...
```

并且, 以第 5 条斜线举例：这条线上的点的坐标 [x, y], x + y 等于 5 - 1
```js
// 第 5 条斜线
a[10] = [0,4]
a[11] = [1,3]
a[12] = [2,2]
a[13] = [3,1]
a[14] = [4,0]
```

并且查看第 4 条，和第 5 条可以有以下规律:
```js
// 第 4 条斜线
a[6] = [3,0]
a[7] = [2,1]
a[8] = [1,2]
a[9] = [0,3]

// 第 5 条斜线
a[10] = [0,4]
a[11] = [1,3]
a[12] = [2,2]
a[13] = [3,1]
a[14] = [4,0]
```

那么:
```
// 第 n 条斜线 (n 为偶数)
a[m]   = [n-1, 0]
a[m+1] = [n-2, 1]
a[m+2] = [n-3, 2]
..

// 第 n 条斜线 ( n 为奇数)
a[m]   = [0, n-1]
a[m+1] = [1, n-2]
a[m+2] = [2, n-3]
```

因此为了求 a[n] 的坐标，我们需要知道 a[n] 在第几条斜线上(假设为 x)? 并且第 x 条斜线上的第一个点的是多少 (是 a[100] 还是 a[200])。

**1. 先求出 a[n] 在第几条斜线上:**  
有以下规律:
```js
f(1) = 0;  // 第一条斜线的初始点为 a[0]
f(2) = 1;  // 第一条斜线的初始点为 a[1]
f(3) = 3;  // 第一条斜线的初始点为 a[3]
f(4) = 6;  // 第一条斜线的初始点为 a[6]
f(5) = 10; // 第一条斜线的初始点为 a[10]

求 f(n) = ?; // 第 n 条斜线的初始点为 a 多少

// 解答
f(2) - f(1) = 1 - 0 = 1
f(3) - f(2) = 3 - 1 = 2
f(4) - f(3) = 6 - 3 = 3
f(5) - f(4) = 10 - 6 = 4
f(n) - f(n-1) = n -1

观察右边是一个等差数列，我们左边加左边，右边加右边，则:

左边相加: (f(2) - f(1)) + (f(3) - f(2)) + (f(n) - f(n-1)) 等于 f(n) - f(1)

右边相加: 1 + 2 + 3 + ... + n -1 = n * (n-1) / 2 (等差数列求和公式，稍后再讲)

而 f(1) 为 0;
因此 f(n) = n * (n-1) / 2;
```
即第 n 条斜线的第一个点的索引为 `a[n * (n-1) / 2]`  

**验证:**  
第 5 条斜线的第一个点为 a[5 * (5 - 1) / 2] 为 a[10] 满足公式。

**2. 已知 f(n) = n * (n-1) / 2，反过来，如果已知 n， 那么 a[n] 属于第几条斜线？(假设为第 x 条斜线)**  

那么:  
```js
a[n] >= (x * (x - 1)) / 2  
a[n] < ((x + 1) * x) / 2
```
代码如下:

```js
function getN(i) {
  let j = 0;
  while (true) {
    if ((j * j - j) <= 2 * i && 2 * i < (j * j + j)) {
      break;
    }
    j++;
  }
  return j;
}

getN(10) // 5，即 a[10] 在第 5 条斜线上
getN(11) // 5，即 a[11] 在第 5 条斜线上
getN(15) // 5，即 a[11] 在第 6 条斜线上
```

**3. 已知 a[i] 在第 n 条斜线，那么如何求 a[i] 的坐标**  

根据, 第 n 条斜线的第一个点，索引为: `n * (n-1) / 2`.

再根据这个:
```js
// 第 n 条斜线 (n 为偶数)
a[m]   = [n-1, 0]  // 第 0 个元素，且此时 m = n * (n-1) / 2
a[m+1] = [n-2, 1]  // 第 1 个元素
a[m+2] = [n-3, 2]  // 第 2 个元素
..

// 第 n 条斜线 ( n 为奇数)
a[m]   = [0, n-1]
a[m+1] = [1, n-2]
a[m+2] = [2, n-3]
```

即对于 a[i], 它属于第 n 条线 (`n 等于 getN(i)`)  

1. 如果 n 为偶数，那么 a[i] 是 [第 n 条斜线] 的 [第 **i - n * (n-1) / 2** 个元素]，它的坐标为 [ n - (i - n * (n-1) / 2) - 1, i - n * (n-1) / 2 ]
2. 如果 n 为奇数，那么 a[i] 的坐标为和 n 为偶数时相反(如果 n 为偶数时，坐标是 [x,y], 那么奇数时为 [y, x])。即坐标为 [ i - n * (n-1) / 2, n - (i - n * (n-1) / 2) - 1 ]

因此代码如下:
```js
function getN(i) {
  let j = 0;
  while (true) {
    if ((j * j - j) <= 2 * i && 2 * i < (j * j + j)) {
      break;
    }
    j++;
  }
  return j;
}

function getXY(i) {
  const n = getN(i);
  const x = i - (n * (n - 1)) / 2;
  const y = n - (i - (n * (n - 1) ) / 2) - 1;
  if (n % 2 === 0) {
    // 偶数
    return [y, x];
  }
  return [x, y];
}

console.log(getXY(16)); // [4, 1]
```

### 3. 等差数列求和

[等差数列求和](./arithmetic-sequence.md)